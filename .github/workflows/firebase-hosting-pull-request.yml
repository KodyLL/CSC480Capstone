# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
on: pull_request
permissions:
  checks: write
  contents: read
  pull-requests: write
jobs:

  cypress-run:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Cypress run
        uses: cypress-io/github-action@v2
        with:
          run: Firebase emulators:start --import=exported-dev-data --export-on-exit=exported-dev-data
          start: npm run serve
          wait-on: <http://localhost:8080/>
          config_file: cypress.json
          spec: "tests/e2e/specs/test.js"
        env:
          CYPRESS_baseUrl: <http://localhost:8080/>
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v4
#      - run: npm install -g firebase-tools
#      - run: npm install
##      - run: Firebase emulators:start --import=exported-dev-data --export-on-exit=exported-dev-data
#      # Install npm dependencies, cache them correctly
#      # and run all Cypress tests
#      - name: Cypress run
#        uses: cypress-io/github-action@v6
#        with:
#          start: |
#            Firebase emulators:start --import=exported-dev-data --export-on-exit=exported-dev-data
#            npm run test:e2e
#    steps:
##      - name: Checkout
#      - uses: actions/checkout@v4
#      - run: npm install
#      - run: Firebase emulators:start --import=exported-dev-data --export-on-exit=exported-dev-data
#      # Install npm dependencies, cache them correctly
#      # and run all Cypress tests
##      - name: Cypress run
#      - uses: cypress-io/github-action@v6
#      - run: npm start:e2e


  build_and_preview:
    needs: cypress-run
    if: ${{ github.event.pull_request.head.repo.full_name == github.repository }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      - run: npm run build
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_CSC480CAPSTONEDB }}
          projectId: csc480capstonedb
